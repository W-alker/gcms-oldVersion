"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}$(".toggleEye > i").click(function(){"fa fa-eye-slash"==$(this).prop("class")?$(".resetPwd-text").prop("type","text"):$(".resetPwd-text").prop("type","password"),$(this).toggleClass("fa-eye-slash").toggleClass("fa-eye")}),$(".hint-box-btn").click(function(){$(".gms-login-hint-box").toggle("fast"),$(this).toggleClass("text-dark").toggleClass("text-success")});var schoolNameList=[];function chooseSchool(){$(".chooseSchool-name").text($(this).text())}sessionStorage.getItem("gms-UNameArray")&&(schoolNameList=sessionStorage.getItem("gms-UNameArray").split(",")),$(".select-school-btn").siblings("i").one("click",function(){sessionStorage.getItem("gms-UNameList")?$(".schoolName-list-box").html(sessionStorage.getItem("gms-UNameList")):$.ajax({url:"./universitiesNameList.json",type:"get",success:function(e){for(var t=e,o="",s=0;s<t.length;s++){for(var a="",l=0;l<t[s].data.length;l++)a+="<tr><td>"+t[s].data[l][0]+"</td></tr>",schoolNameList.push(t[s].data[l][0]);o+='<table class="table table-hover"><thead>\n                                  <tr><th>'.concat(t[s].name,"</th></tr></thead>\n                                  <tbody>").concat(a,"</tbody></table>")}$(".schoolName-list-box").html(o),$(".schoolName-list-box td").click(chooseSchool),sessionStorage.setItem("gms-UNameList",o),sessionStorage.setItem("gms-UNameArray",schoolNameList)},error:function(){alert("学校名称读取失败！")}}),$(".schoolName-list-box td").click(chooseSchool)}),$(".search-schoolName").keyup(function(){if($(".search-schoolName").val()){for(var e=$(".search-schoolName").val(),t="",o=0;o<schoolNameList.length;o++)schoolNameList[o].match(e.trim())&&(t+="<tr><td>".concat(schoolNameList[o],"</td></tr>"));var s='<table class="table table-hover">'.concat(t,"</table>");$(".schoolName-list-box").html(s),$(".schoolName-list-box td").click(chooseSchool)}else $(".schoolName-list-box").html(sessionStorage.getItem("gms-UNameList")),$(".schoolName-list-box td").click(chooseSchool)}),$(".chooseSchool-btn").click(function(){$(".select-school-btn").val($(".chooseSchool-name").text())}),$(".rememberPwd").click(function(){$(this).find("i").toggleClass("fa-circle-o").toggleClass("fa-check-circle-o")}),localStorage.getItem("schoolName")&&($(".select-school-btn").val(localStorage.getItem("schoolName")),$(".input-idCode").val(localStorage.getItem("idCode")),$('[id="'.concat(localStorage.getItem("identiy"),'"]')).prop("checked","checked"),"true"===localStorage.getItem("autoLogin")&&$.ajax({url:"/user.html/autoLogin",type:"post",contentType:"application/json",success:function(e){alert("正在尝试自动登录..."),location.href="./".concat(localStorage.identiy,".html")},error:function(e){console.log(e)},statusCode:{401:function(){alert("自动登录失败！")}}})),$(".login-submit").click(function(){var t=new FormData(document.querySelector(".gms-login-form"));if(t.get("idCode")&&isIdCode(t.get("idCode")))if(t.get("password")&&isPwd(t.get("password")))if(t.get("identiy")){var o=$('[name="identiy"]:checked').prop("id");t.set("identiy",o),$.ajax({url:"./login",type:"post",data:t,processData:!1,contentType:!1,success:function(e){switch(e.err){case 0:localStorage.setItem("schoolName",t.get("SName")),localStorage.setItem("idCode",t.get("idCode")),localStorage.setItem("identiy",o),1===$(".fa-check-circle-o").length?localStorage.setItem("autoLogin",!0):0===$(".fa-check-circle-o").length&&localStorage.setItem("autoLogin",!1),window.location.href=e.link;break;case"idCode":$(".alert").css("display","none").eq(0).text("学号/工号不存在！").show();break;case"pwd":$(".alert").css("display","none").eq(1).text("您的密码有误！").show("fast")}console.log(e)},error:function(e){console.log(e)}})}else $(".alert").css("display","none").eq(2).show("fast");else $(".alert").css("display","none").eq(1).text("请输入正确密码！").show("fast");else $(".alert").css("display","none").eq(0).text("请输入正确学号！").show("fast")}),$(".get-verifyCode-link").click(function(){var e=$("#gms-resetPwd-box .input-email").val(),t=$("#gms-resetPwd-box .input-idCode").val();if(!e)return alert("请输入邮箱！");$.ajax({headers:{idCode:t,email:e},url:"/resetPwd/get_verifyCode",type:"post",contentType:"application/json",success:function(e){$("#gms-resetPwd-box .alert").css("display","none").eq(1).css("display","block").text(e.msg)},error:function(e){console.log(e)}})}),$('#gms-resetPwd-box [type="submit"]').click(function(){var e,t=new FormData(document.querySelector("#gms-resetPwd-box form"));t.get("idCode")?t.get("verifyCode")?t.get("newPwd")?$.ajax((_defineProperty(e={url:"/resetPwd",type:"post",contentType:"application/json",data:t,processData:!1},"contentType",!1),_defineProperty(e,"success",function(e){"verifyCode"!==e.err?"idCode"!==e.err?0===e.err&&($("#gms-resetPwd-box .alert").css("display","none"),alert("密码重置成功！")):$("#gms-resetPwd-box .alert").css("display","none").eq(0).css("display","block").text(e.msg):$("#gms-resetPwd-box .alert").css("display","none").eq(1).css("display","block").text(e.msg)}),_defineProperty(e,"error",function(e){console.log(e)}),e)):$("#gms-resetPwd-box .alert").css("display","none").eq(2).css("display","block").text("请输入新密码！"):$("#gms-resetPwd-box .alert").css("display","none").eq(1).css("display","block").text("请输入验证码！"):$("#gms-resetPwd-box .alert").css("display","none").eq(0).css("display","block").text("请输入学号！")});